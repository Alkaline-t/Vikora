document.addEventListener("DOMContentLoaded",()=>{
    // const typingAudio=document.getElementById("typingSound");
    // typingAudio.volume=0.8;
    const chatInput=document.getElementById("chatInput");
    console.log("chatInput element:", chatInput);
    const sendMessageBtn=document.getElementById("sendMessage");
    console.log("sendMessageBtn element:", sendMessageBtn);
    const chatMessages=document.getElementById("chatMessages");
    console.log("chatMessages element:", chatMessages);
    const clearChatBtn=document.getElementById("clearChatBtn");
    console.log("clearChatBtn element:", clearChatBtn);
    const themeToggle=document.getElementById("themeToggle");
    console.log("themeToggle element:", themeToggle);
    let userName=null;
  
    setTimeout(()=>speak("Hi, I'm Vik Ai ‚Äî your learning companion from Ikora. How can I help you explore the future today?"),900);
  
    /* üåó theme */
    if (themeToggle) {
      themeToggle.onclick=()=>{
        console.log("Theme toggle clicked!");
        const body=document.body;
        body.classList.toggle("dark-mode");
        body.classList.toggle("light-mode");
        const dark=body.classList.contains("dark-mode");
        themeToggle.textContent=dark?"‚òÄÔ∏è":"üåô";
        speak(dark?"Dark mode activated.":"Light mode activated.");
      };
    }
  
    /* üé§ mic + volume */
    const micButton=document.createElement("button");
    micButton.textContent="üéôÔ∏è";
    micButton.style.marginLeft="8px";
    chatInput.insertAdjacentElement("afterend",micButton);
    const volumeBtn=document.createElement("button");
    volumeBtn.textContent="üîä";
    volumeBtn.style.marginLeft="6px";
    micButton.insertAdjacentElement("afterend",volumeBtn);
    let volumeLevel=2;
    volumeBtn.onclick=()=>{
      volumeLevel=(volumeLevel+1)%3;
      if(volumeLevel===2){// typingAudio.volume=0.8;volumeBtn.textContent="üîä";}
      else if(volumeLevel===1){// typingAudio.volume=0.4;volumeBtn.textContent="üîâ";}
      else {// typingAudio.volume=0;volumeBtn.textContent="üîá";}
    };
  
    const banned=["violence","hate","weapon","kill","suicide","bomb","sexual","porn","drug","nude","terror","crime"];
    if (sendMessageBtn) {
      sendMessageBtn.onclick=()=>{
        console.log("Send message button clicked!");
        sendMessage();
      };
    }
    if (chatInput) {
      chatInput.addEventListener("keypress",e=>{
        if(e.key==="Enter"){
          console.log("Enter key pressed in chat input!");
          sendMessage();
        }
      });
    }
  
    if (clearChatBtn) {
      clearChatBtn.onclick=()=>{
        console.log("Clear chat button clicked!");
        clearChatBtn.classList.add("spin");
        setTimeout(()=>clearChatBtn.classList.remove("spin"),600);
        chatMessages.style.opacity="0";
        setTimeout(()=>{
          chatMessages.innerHTML=`<div class="message-bubble ai-message fade-in">
            <img src="images/logo.png" alt="AI Logo" class="ai-message-logo">
            <span>Chat cleared! I'm Vik Ai ‚Äî ready for a fresh start. What would you like to explore?</span>
          </div>`;
          chatMessages.style.opacity="1";
          userName=null;
          speak("Chat cleared. I'm Vik Ai, ready for a fresh start!");
        },400);
      };
    }
  
    /* üéôÔ∏è speech-to-text */
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    const rec=SR?new SR():null;
    if(rec){
      rec.lang="en-IN";
      rec.onresult=e=>{
        chatInput.value=e.results[0][0].transcript;
        micButton.textContent="üéôÔ∏è";
        sendMessage();
      };
      micButton.onclick=()=>{rec.start();micButton.textContent="üéß Listening...";};
      rec.onerror=()=>micButton.textContent="üéôÔ∏è";
    }else micButton.style.display="none";
  
    /* üí¨ main chat logic */
    function sendMessage(){
      const userText=chatInput.value.trim();
      if(!userText)return;
      const text=userText.toLowerCase();
  
      const udiv=document.createElement("div");
      udiv.classList.add("message-bubble","user-message");
      udiv.textContent=`You: ${userText}`;
      chatMessages.appendChild(udiv);
      chatInput.value="";
      chatMessages.scrollTop=chatMessages.scrollHeight;
  
      const typingDiv=document.createElement("div");
      typingDiv.classList.add("message-bubble","ai-message");
      typingDiv.innerHTML=`<img src="images/logo.png" alt="AI Logo" class="ai-message-logo"><span>Vik Ai is thinking<span class="typing-indicator">...</span></span>`;
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop=chatMessages.scrollHeight;
      // try{typingAudio.currentTime=0;typingAudio.play();}catch{}
  
      setTimeout(()=>{
        typingDiv.remove();
        // typingAudio.pause();
  
        const adiv=document.createElement("div");
        adiv.classList.add("message-bubble","ai-message","fade-in");
        const aiLogo=document.createElement("img");
        aiLogo.src="images/logo.png";aiLogo.classList.add("ai-message-logo");
        adiv.appendChild(aiLogo);
        const span=document.createElement("span");
        adiv.appendChild(span);
  
        let reply="";
        const isBad=banned.some(k=>text.includes(k));
        const nameMatch=text.match(/(my name is|i am)\\s+([a-zA-Z]+)/);
  
        if(isBad){
          reply="Sorry, I can't discuss or explain topics that are unsafe or illegal. Let's keep our chat about innovation, education, and the future.";
        }
        else if(text.includes("your name")||text.includes("who are you")){
          reply="I'm Vik Ai ‚Äî your friendly digital mentor from Vikora, here to help you understand technology, careers, and Future-Ready Skills.";
        }
        else if(nameMatch&&nameMatch[2]){
          userName=nameMatch[2][0].toUpperCase()+nameMatch[2].slice(1);
          reply=`Nice to meet you, ${userName}! Let's explore something futuristic together.`;
        }
        else if(text.includes("vikora")||text.includes("ikora")){
          reply="Vikora is an educational initiative focused on Future-Ready Skills and digital innovation. It helps students like you learn coding, AI, creative design, and problem-solving ‚Äî aligned with the Viksit Bharat Buildathon 2025 vision of an innovative, self-reliant India. It empowers curiosity, creativity, and collaboration to build a smarter future.";
        }
        else if(text.includes("viksit bharat")||text.includes("buildathon")){
          reply="Viksit Bharat Buildathon 2025 is a national innovation challenge promoting creative, tech-based solutions for India's growth ‚Äî guided by the spirit of 'Vocal for Local' and 'Atmanirbhar Bharat'. It motivates young minds to design, code, and innovate for a developed nation.";
        }
        else if(text.includes("future ready skills")||text.includes("future skills")){
          reply="Future-Ready Skills are abilities like digital fluency, problem-solving, AI literacy, critical thinking, communication, and creativity ‚Äî everything that helps students succeed in tomorrow's fast-changing world.";
        }
        else if(text.includes("ai")||text.includes("artificial intelligence")){
          reply="Artificial Intelligence is the science of making computers think and learn like humans. It powers chatbots, robots, smart assistants, and data-driven decision systems shaping the modern world.";
        }
        else if(text.includes("career")||text.includes("job")){
          reply="Emerging career paths include AI Engineer, Data Scientist, Cyber-Security Analyst, Green-Energy Innovator, UX Designer, and Robotics Developer. Adaptability and creativity are key to success.";
        }
        else if(text.includes("technology")||text.includes("future trends")){
          reply="Future technologies include AI, Quantum Computing, Renewable Energy, Biotechnology, and Space Exploration ‚Äî all redefining how we live and work.";
        }
        else if(text.includes("thank")){
          reply="You're most welcome! Keep exploring ‚Äî every question makes you more future-ready üöÄ";
        }
        else if(text.includes("hello")||text.includes("hi")||text.includes("hey")||text.includes("greetings")){
          const greetings=userName?
            [`Hey ${userName}! How can I assist you today?`,
             `Hello ${userName}! What\'s on your mind?`,
             `Hi ${userName}, ready to learn something new?`]:
            ["Hello! I'm Vik Ai ‚Äî ready to explore the future with you.",
             "Hi there! How can I help you today?",
             "Greetings! What futuristic topic shall we dive into?"];
          reply=greetings[Math.floor(Math.random()*greetings.length)];
        }
        else if(text.includes("how are you")||text.includes("how do you do")){
          reply="As an AI, I don\'t have feelings, but I\'m ready and eager to assist you! How can I be of service?";
        }
        else if(text.includes("what can you do")||text.includes("help me")||text.includes("your capabilities")){
          reply="I can help you explore Future-Ready Skills, explain AI and technology trends, discuss career paths, and provide information about Vikora and Viksit Bharat initiatives. Just ask me anything related to these topics!";
        }
        else{
          const defaultReplies=userName?
            [`That's an interesting point, ${userName}! I focus on safe, educational, and future-oriented topics. Can you rephrase or ask something about technology, skills, or innovation?`,
             `Hmm, I\'m designed to help with future-ready skills, ${userName}. Maybe try asking about a specific technology, career, or educational topic?`,
             `My expertise is in areas like AI, education, and innovation, ${userName}. What's a future-focused question you have for me?`]:
            ["That's a thoughtful question! I focus on safe, educational, and future-oriented topics. Try asking me about technology, skills, or innovation ‚Äî I'll explain just like ChatGPT would, but simpler and school-friendly.",
             "I\'m here to discuss future-ready skills, technology, and innovation. What specific topic are you curious about today?",
             "My goal is to help you learn about the future. Can you ask me a question related to careers, AI, or new technologies?"];
          reply=defaultReplies[Math.floor(Math.random()*defaultReplies.length)];
        }
  
        span.textContent=reply;
        chatMessages.appendChild(adiv);
        chatMessages.scrollTop=chatMessages.scrollHeight;
        speak(reply);
      },900);
    }
  
    /* üó£ male voice */
    function speak(text){
      if("speechSynthesis" in window){
        const synth=window.speechSynthesis;
        const voices=synth.getVoices();
        const male=voices.find(v=>
          v.name.includes("Male")||v.name.includes("David")||
          v.name.includes("Daniel")||v.name.includes("Google UK English Male")||
          v.name.includes("Microsoft David"));
        const u=new SpeechSynthesisUtterance(text);
        u.lang="en-IN";u.rate=1;u.pitch=0.9;if(male)u.voice=male;
        synth.cancel();synth.speak(u);
      }
    }
    // Remove extraneous closing bracket and parenthesis
      // (No misplaced closing bracket or parenthesis here anymore; event listener closures, if any, should be placed outside function scopes.)

